<?xml version="1.0" encoding="utf-8"?>
<odoo>
     
           <!-- Contribution Register -->

    <record id="hr_CNSS_register" model="hr.contribution.register">
        <field name="name">La Caisse Nationale de Sécurité Sociale</field>
    </record>

    <record id="hr_retraite_register" model="hr.contribution.register">
        <field name="name">Organisme de retraite complementaire CIMR</field>
    </record>

    <record id="hr_cci_register" model="hr.contribution.register">
        <field name="name">Chambre du commerce et de l'industrie</field>
    </record>

    <record id="hr_prevoyance_register" model="hr.contribution.register">
        <field name="name">Organisme de Mutuelle et prévoyance</field>
    </record>

    <record id="hr_prime__register" model="hr.contribution.register">
        <field name="name">Primes et Indémnités</field>
    </record>

  <!-- HR SALARY RULE CATEGORIES-->
    <record id="NOCAT" model="hr.salary.rule.category">
        <field name="name">NO CATEGORY</field>
        <field name="code">NOCAT</field>
        <field name="parent_id" eval="False"/>
    </record>
 
 <!-- HR SALARY RULES-->
    <record id="hr_payslip_rule_abs" model="hr.salary.rule">
       <field name="name">Absences par jour</field>
       <field name="code">ABS</field>
       <field name="sequence">1</field>
       <field name="category_id" ref="hr_payroll.BASIC"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = worked_days.IMPAYE and worked_days.IMPAYE.number_of_days  > 0 </field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = worked_days.IMPAYE and worked_days.IMPAYE.number_of_days </field>
       <field name="appears_on_payslip" eval="True"/>
    </record>

    <record id="hr_payslip_rule_absh" model="hr.salary.rule">
       <field name="name">Absences par heure</field>
       <field name="code">ABSH</field>
       <field name="sequence">2</field>
       <field name="category_id" ref="hr_payroll.BASIC"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.ABSH and inputs.ABSH.amount > 0 </field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.ABSH and - (inputs.ABSH.amount)</field>
       <field name="appears_on_payslip" eval="True"/>
    </record>

    <record id="hr_payslip_rule_jrtv" model="hr.salary.rule">
       <field name="name">NB Jours Travaillés</field>
       <field name="code">JRTV</field>
       <field name="sequence">3</field>
       <field name="category_id" ref="NOCAT"/>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = 26 - categories.ABS</field>
       <field name="appears_on_payslip" eval="True"/>
    </record>

    <record id="hr_payslip_rule_tjrtv" model="hr.salary.rule">
       <field name="name">Total Jours Travaillés</field>
       <field name="code">TJRTV</field>
       <field name="sequence">4</field>
       <field name="category_id" ref="NOCAT"/>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = payslip.sum('JRTV', '2019-01-01', '2019-12-31') + JRTV</field>
       <field name="appears_on_payslip" eval="False"/>
    </record>
	
    <record id="hr_payroll.hr_rule_basic" model="hr.salary.rule">
       <field name="name">Salaire de base</field>
       <field name="code">BASE</field>
       <field name="sequence">5</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = (contract.wage/26)*JRTV</field>
    </record>
 
    <record id="hr_payslip_rule_regul" model="hr.salary.rule">
       <field name="name">Régularisation Congé</field>
       <field name="code">REGUL</field>
       <field name="sequence">23</field>
       <field name="category_id" ref="hr_payroll.BASIC"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.REGUL and inputs.REGUL.amount > 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.REGUL and inputs.REGUL.amount</field>
       <field name="appears_on_payslip" eval="True"/>
    </record>

    <record id="hr_payslip_rule_rap_base" model="hr.salary.rule">
       <field name="name">Rappel Salaire de Base</field>
       <field name="code">RAPBASE</field>
       <field name="sequence">24</field>
       <field name="category_id" ref="hr_payroll.BASIC"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.RAPBASE and inputs.RAPBASE.amount > 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.RAPBASE and inputs.RAPBASE.amount</field>
       <field name="appears_on_payslip" eval="True"/>
    </record>
	
    <record id="hr_payslip_rule_grat13" model="hr.salary.rule">
       <field name="name">Gratification 13ème mois</field>
       <field name="code">GRAT13</field>
       <field name="sequence">30</field>
       <field name="category_id" ref="GRAT"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = payslip.date_from.month == 12 and inputs.GRAT13 and inputs.GRAT13.amount == 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">coef = 12 - (employee.service_start_date.month - 1)
result = contract.wage*(coef/12) if (employee.service_start_date.year == 2020) and (employee.service_start_date.month != 1) else contract.wage</field>
       <field name="appears_on_payslip" eval="True"/>
       <field name="register_id" ref="hr_prime__register"/>
    </record>

    <record id="hr_payslip_rule_grat6" model="hr.salary.rule">
       <field name="name">Gratification Juin</field>
       <field name="code">GRAT6</field>
       <field name="sequence">30</field>
       <field name="category_id" ref="GRAT"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = payslip.date_from.month == 6 and inputs.GRAT6 and inputs.GRAT6.amount == 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">coef = 12 - (employee.service_start_date.month - 1)
result = contract.wage*(coef/12) if (employee.service_start_date.year == 2020) and (employee.service_start_date.month != 1) else contract.wage</field>
       <field name="appears_on_payslip" eval="True"/>
       <field name="register_id" ref="hr_prime__register"/>
    </record>

    <record id="hr_payslip_rule_grat13bis" model="hr.salary.rule">
       <field name="name">Gratification 13ème mois</field>
       <field name="code">GRAT13BIS</field>
       <field name="sequence">30</field>
       <field name="category_id" ref="GRAT"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.GRAT13 and inputs.GRAT13.amount > 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.GRAT13 and inputs.GRAT13.amount</field>
       <field name="appears_on_payslip" eval="True"/>
       <field name="register_id" ref="hr_prime__register"/>
    </record>

    <record id="hr_payslip_rule_grat6bis" model="hr.salary.rule">
       <field name="name">Gratification Juin</field>
       <field name="code">GRAT6BIS</field>
       <field name="sequence">30</field>
       <field name="category_id" ref="GRAT"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.GRAT6 and inputs.GRAT6.amount > 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.GRAT6 and inputs.GRAT6.amount</field>
       <field name="appears_on_payslip" eval="True"/>
       <field name="register_id" ref="hr_prime__register"/>
    </record>

    <record id="hr_payslip_rule_gradiv" model="hr.salary.rule">
       <field name="name">Gratification Divers</field>
       <field name="code">GRADIV</field>
       <field name="sequence">31</field>
       <field name="category_id" ref="BASIC"/>
       <field name="condition_select">python</field>
       <field name="condition_python">result = inputs.GRADIV and inputs.GRADIV.amount > 0</field>
       <field name="amount_select">code</field>
       <field name="amount_python_compute">result = inputs.GRADIV and inputs.GRADIV.amount</field>
       <field name="appears_on_payslip" eval="True"/>
       <field name="register_id" ref="hr_prime__register"/>
    </record>
	
 <!--HR structure -->

    <record id="hr_payroll_salary_structure_base" model="hr.payroll.structure">
        <field name="code">Ma-Base-</field>
        <field name="name">Structure de base paie Marocaine</field>
        <field eval="[(6, 0, [ref('hr_payslip_rule_abs'),ref('hr_payslip_rule_absh'),ref('hr_payslip_rule_jrtv'),ref('hr_payslip_rule_tjrtv'), ref('hr_payslip_rule_regul'),ref('hr_payslip_rule_rap_base'), ref('hr_payslip_rule_grat13'), ref('hr_payslip_rule_grat6'), ref('hr_payslip_rule_grat13bis'), ref('hr_payslip_rule_grat6bis'),ref('hr_payslip_rule_gratdiv'),])]" name="rule_ids"/>
        <field name="company_id" ref="base.main_company"/>
        <field name="note">Cette rubrique représente la structure des employés marocains.</field>
    </record>
	
<!-- Rule Inputs -->
	
    <record id="hr_rule_input_absh" model="hr.rule.input">
        <field name="code">ABSH</field>
        <field name="name">Absences par Heures</field>
        <field name="input_id" ref="hr_payslip_rule_absh"/>
    </record>
  
    <record id="hr_rule_input_regul" model="hr.rule.input">
        <field name="code">REGUL</field>
        <field name="name">Régularisation Congés</field>
        <field name="input_id" ref="hr_payslip_rule_regul"/>
    </record>

    <record id="hr_rule_input_regul_base" model="hr.rule.input">
        <field name="code">RAPBASE</field>
        <field name="name">Rappel Salaire de Base</field>
        <field name="input_id" ref="hr_payslip_rule_rap_base"/>
    </record>
	
    <record id="hr_rule_input_grat13" model="hr.rule.input">
        <field name="code">GRAT13</field>
        <field name="name">Gratification 13 mois</field>
        <field name="input_id" ref="hr_payslip_rule_grat13bis"/>
    </record>

    <record id="hr_rule_input_grat6" model="hr.rule.input">
        <field name="code">GRAT6</field>
        <field name="name">Gratification Juin</field>
        <field name="input_id" ref="hr_payslip_rule_grat6bis"/>
    </record>

    <record id="hr_rule_input_gradiv" model="hr.rule.input">
        <field name="code">GRADIV</field>
        <field name="name">Gratification Divers</field>
        <field name="input_id" ref="hr_payslip_rule_gradiv"/>
    </record>
</odoo>
